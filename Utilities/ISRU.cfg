//Leaves only one resource converter module (MonoPropellant)
@PART[*]:HAS[@MODULE[ModuleResourceConverter]:HAS[@OUTPUT_RESOURCE:HAS[#ResourceName[MonoPropellant]]]] {
	@MODULE[ModuleResourceConverter]:HAS[@OUTPUT_RESOURCE:HAS[#ResourceName[MonoPropellant]]] {
		@name = BackupModuleResourceConverter //Temporarily renames the first resource converter module
	}
}
@PART[*]:HAS[@MODULE[BackupModuleResourceConverter]] {
	-MODULE[ModuleResourceConverter],* {} //Deletes all remaining resource converter modules
}
@PART[*]:HAS[@MODULE[BackupModuleResourceConverter]] {
	origMonoPropellantRatio = #$/MODULE[BackupModuleResourceConverter]/OUTPUT_RESOURCE/Ratio$ //Saves the default monopropellant output ratio for later
	@MODULE[BackupModuleResourceConverter],0 {
		@name = ModuleResourceConverter //Renames back the resource converter module
		@StartActionName = Start ISRU
		@StopActionName = Stop ISRU
	}
}

//Creates the switcher for all available fuel mixtures
@PART[*]:HAS[@MODULE[ModuleResourceConverter]:HAS[@OUTPUT_RESOURCE:HAS[#ResourceName[MonoPropellant]]]] {
	MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = simpleFuelsRssISRU
		switcherDescription = ISRU Mode
		switcherDescriptionPlural = ISRU Modes
		affectDragCubes = false
		affectFARVoxels = false
		switchInFlight = false
		advancedTweakablesOnly = false
		uiGroupName = simpleFuelsRssIsruMode
		uiGroupDisplayName = ISRU Modes

		SUBTYPE
		{
			name = RP1_LO2
			title = RP1+LO2
			addedMass = 0
			addedCost = 0
			primaryColor = #ff0000
			secondaryColor = #aaaaaa
	
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleResourceConverter
				}
				DATA
				{
					ConverterName = RP1+LO2
					OUTPUT_RESOURCE
					{
						ResourceName = Kerosene
						Ratio = 0.3
					}
					OUTPUT_RESOURCE
					{
						ResourceName = LqdOxygen
						Ratio = 0.7
					}
				}
			}
		}

		SUBTYPE
		{
			name = LH2_LO2
			title = LH2+LO2
			addedMass = 0
			addedCost = 0
			primaryColor = #0ab7fc
			secondaryColor = #aaaaaa
	
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleResourceConverter
				}
				DATA
				{
					ConverterName = LH2+LO2
					OUTPUT_RESOURCE
					{
						ResourceName = LqdHydrogen
						Ratio = 0.75
					}
					OUTPUT_RESOURCE
					{
						ResourceName = LqdOxygen
						Ratio = 0.25
					}
				}
			}
		}

		SUBTYPE
		{
			name = LCH4_LO2
			title = LCH4+LO2
			addedMass = 0
			addedCost = 0
			primaryColor = #7507fc
			secondaryColor = #aaaaaa
	
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleResourceConverter
				}
				DATA
				{
					ConverterName = LCH4+LO2
					OUTPUT_RESOURCE
					{
						ResourceName = LqdMethane
						Ratio = 0.45
					}
					OUTPUT_RESOURCE
					{
						ResourceName = LqdOxygen
						Ratio = 0.55
					}
				}
			}
		}

		SUBTYPE
		{
			name = AEROZINE50_N2O4
			title = AEROZINE50+N2O4
			addedMass = 0
			addedCost = 0
			primaryColor = #00ff00
			secondaryColor = #ffff00
	
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleResourceConverter
				}
				DATA
				{
					ConverterName = AEROZINE50+N2O4
					OUTPUT_RESOURCE
					{
						ResourceName = Aerozine50
						Ratio = 0.3
					}
					OUTPUT_RESOURCE
					{
						ResourceName = NTO
						Ratio = 0.7
					}
				}
			}
		}

		SUBTYPE
		{
			name = LO2
			title = LO2
			addedMass = 0
			addedCost = 0
			primaryColor = #aaaaaa
			secondaryColor = #aaaaaa
	
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleResourceConverter
				}
				DATA
				{
					ConverterName = LO2
					OUTPUT_RESOURCE
					{
						ResourceName = LqdOxygen
						Ratio = 1
					}
				}
			}
		}

		SUBTYPE
		{
			name = RP1
			title = RP1
			addedMass = 0
			addedCost = 0
			primaryColor = #ff0000
			secondaryColor = #ff0000
	
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleResourceConverter
				}
				DATA
				{
					ConverterName = RP1
					OUTPUT_RESOURCE
					{
						ResourceName = Kerosene
						Ratio = 1
					}
				}
			}
		}

		SUBTYPE
		{
			name = LH2
			title = LH2
			addedMass = 0
			addedCost = 0
			primaryColor = #0ab7fc
			secondaryColor = #0ab7fc
	
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleResourceConverter
				}
				DATA
				{
					ConverterName = LH2
					OUTPUT_RESOURCE
					{
						ResourceName = LqdHydrogen
						Ratio = 1
					}
				}
			}
		}

		SUBTYPE
		{
			name = CH4
			title = CH4
			addedMass = 0
			addedCost = 0
			primaryColor = #7507fc
			secondaryColor = #7507fc
	
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleResourceConverter
				}
				DATA
				{
					ConverterName = CH4
					OUTPUT_RESOURCE
					{
						ResourceName = LqdMethane
						Ratio = 1
					}
				}
			}
		}
	
		SUBTYPE
		{
			name = Hydrazine
			title = Hydrazine
			addedMass = 0
			addedCost = 0
			primaryColor = #b7854e
			secondaryColor = #b7854e
	
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleResourceConverter
				}
				DATA
				{
					ConverterName = Hydrazine
					OUTPUT_RESOURCE
					{
						ResourceName = Hydrazine
						Ratio = 1
					}
				}
			}
		}
	}
}

//Applies the original ratio for the output resource ratio on all fuel mixtures
@PART[*]:HAS[@MODULE[ModuleResourceConverter]:HAS[@OUTPUT_RESOURCE:HAS[#ResourceName[MonoPropellant]]]] {
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[simpleFuelsRssISRU]] {
		@SUBTYPE,* {
			@MODULE,0 {
				@DATA,1 {
					@OUTPUT_RESOURCE,* {
						@Ratio *= #$/origMonoPropellantRatio$
					}
				}
			}
		}
	}
}
//Matches all engines that use default XenonGas (e.g. Stock DAWN)
@PART[*]:HAS[@MODULE[ModuleEngines*]:HAS[@PROPELLANT[XenonGas]]]
{
	origIspVac = #$/MODULE[ModuleEngines*]/atmosphereCurve/key,0[1, ]$
	origIspSL = #$/MODULE[ModuleEngines*]/atmosphereCurve/key,1[1, ]$
	origMaxThrust = #$/MODULE[ModuleEngines*]/maxThrust$

	@MODULE[ModuleEngines*] {
		@name = TempModuleEngines
	}

	MODULE {
		name = MultiModeEngine
		primaryEngineID = Normal
		primaryEngineModeDisplayName = Normal
		secondaryEngineID = HTLI
		secondaryEngineModeDisplayName = High thrust, low ISP
	}

	+MODULE[TempModuleEngines] {
		@name = ModuleEnginesFX
		@engineID = Normal
	}

	+MODULE[TempModuleEngines] {
		@name = ModuleEnginesFX
		@engineID = HTLI
	}

	-MODULE[TempModuleEngines] {}

	MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = simpleFuelsRssEngineModeIon
		switcherDescription = Ion Engine mode
		switcherDescriptionPlural = Ion Engine modes
		affectDragCubes = false
		affectFARVoxels = false
		switchInFlight = false
		advancedTweakablesOnly = false
		uiGroupName = simpleFuelsRssEngineModesIon
		uiGroupDisplayName = Ion Engine modes

		SUBTYPE
		{
			name = XenonGas
			title = XenonGas
			addedMass = 0
			addedCost = 0
			primaryColor = #7aefef
			secondaryColor = #7aefef

			MODULE
			{
				IDENTIFIER
				{
					name = ModuleEngines*
					engineID = Normal
				}
				DATA
				{
					maxThrust = 3333 //Placeholder, will be changed later
					PROPELLANT
					{
						name = XenonGas
						ratio = 1
						DrawGauge = True
					}
					PROPELLANT
					{
						name = ElectricCharge
						ratio = 10
						DrawGauge = True
						minResToLeave = 1.0
					}
					atmosphereCurve
					{
						key = 0 6666 //Placeholder, will be changed later
						key = 1 6666 //Placeholder, will be changed later
					}
				}
			}

			MODULE
			{
				IDENTIFIER
				{
					name = ModuleEngines*
					engineID = HTLI
				}
				DATA
				{
					maxThrust = 3333 //Placeholder, will be changed later
					PROPELLANT
					{
						name = XenonGas
						ratio = 1
						DrawGauge = True
					}
					PROPELLANT
					{
						name = ElectricCharge
						ratio = 10
						DrawGauge = True
						minResToLeave = 1.0
					}
					atmosphereCurve
					{
						key = 0 5555 //Placeholder, will be changed later
						key = 1 5555 //Placeholder, will be changed later
					}
				}
			}
		}

		SUBTYPE
		{
			name = ArgonGas
			title = ArgonGas
			addedMass = 0
			addedCost = 0
			primaryColor = #ef7ae7
			secondaryColor = #ef7ae7

			MODULE
			{
				IDENTIFIER
				{
					name = ModuleEngines*
					engineID = Normal
				}
				DATA
				{
					maxThrust = 3333 //Placeholder, will be changed later
					PROPELLANT
					{
						name = ArgonGas
						ratio = 1
						DrawGauge = True
					}
					PROPELLANT
					{
						name = ElectricCharge
						ratio = 0.25
						DrawGauge = True
						minResToLeave = 1.0
					}
					atmosphereCurve
					{
						key = 0 4444 //Placeholder, will be changed later
						key = 1 4444 //Placeholder, will be changed later
					}
				}
			}

			MODULE
			{
				IDENTIFIER
				{
					name = ModuleEngines*
					engineID = HTLI
				}
				DATA
				{
					maxThrust = 3333 //Placeholder, will be changed later
					PROPELLANT
					{
						name = ArgonGas
						ratio = 1
						DrawGauge = True
					}
					PROPELLANT
					{
						name = ElectricCharge
						ratio = 0.25
						DrawGauge = True
						minResToLeave = 1.0
					}
					atmosphereCurve
					{
						key = 0 3333 //Placeholder, will be changed later
						key = 1 3333 //Placeholder, will be changed later
					}
				}
			}
		}
	}
}

//Applies the original engine ISP on the new variants
@PART[*]:HAS[@MODULE[ModuleEngines*]:HAS[@PROPELLANT[XenonGas]]] {
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[simpleFuelsRssEngineModeIon]] {
		@SUBTYPE[*],* {
			@MODULE,* {
				@DATA,* {
					@maxThrust = #$/origMaxThrust$
					@atmosphereCurve {
						@key,0[1, ] = #$/origIspVac$
						@key,1[1, ] = #$/origIspSL$
					}
				}
			}
		}
	}
}

@PART[*]:HAS[@MODULE[ModuleEngines*]:HAS[@PROPELLANT[XenonGas]]] {
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[simpleFuelsRssEngineModeIon]] {
		@SUBTYPE[XenonGas] {
			@MODULE,0 { //Normal mode
				@DATA {
					@maxThrust *= 1
					@atmosphereCurve {
						@key,0[1, ] *= 1
						@key,1[1, ] *= 1
					}
				}
			}

			@MODULE,1 { //HTLI mode
				@DATA {
					@maxThrust *= 3
					@atmosphereCurve {
						@key,0[1, ] *= 0.7
						@key,1[1, ] *= 0.7
					}
				}
			}
		}

		@SUBTYPE[ArgonGas] {
			@MODULE,0 { //Normal mode
				@DATA {
					@maxThrust *= 0.9
					@atmosphereCurve {
						@key,0[1, ] *= 0.9
						@key,1[1, ] *= 0.9
					}
				}
			}

			@MODULE,1 { //HTLI mode
				@DATA {
					@maxThrust *= 2.7
					@atmosphereCurve {
						@key,0[1, ] *= 0.63
						@key,1[1, ] *= 0.63
					}
				}
			}
		}
	}
}